<!DOCTYPE html>
<html>
<head>
<meta name="description" content="Konva demo">
  <script src="https://unpkg.com/konva@^2/konva.min.js"></script>
  <meta charset="utf-8">
  <script src="https://unpkg.com/pdf-lib@1.4.0"></script>
  <script src="https://unpkg.com/downloadjs@1.4.7"></script>
  <link rel="stylesheet" href="./style.css" />
</head>
<body>
  <div id="container"></div>
  <p>Click the button to modify an existing PDF document with <code>pdf-lib</code></p>
    <button onclick="modifyPdf()">Modify PDF</button>
    <br />
    <!--<div id="buttons"><button id="save">Save as image</button></div>-->
    <p class="small">(Your browser will download the resulting file)</p>

  <script>

        const { degrees, PDFDocument, rgb, StandardFonts, drawImage, drawText } = PDFLib

        async function modifyPdf() {
        // Fetch an existing PDF document
        const url = 'myPDF.pdf'
        const existingPdfBytes = await fetch(url).then(res => res.arrayBuffer())

        // Load a PDFDocument from the existing PDF bytes
        const pdfDoc = await PDFDocument.load(existingPdfBytes)

        // Embed the Helvetica font
        const helveticaFont = await pdfDoc.embedFont(StandardFonts.Helvetica)

        // Get the first page of the document
        const pages = pdfDoc.getPages()
        const firstPage = pages[0]
        const secondPage = pages[1]
        const thirdPage = pages[2]
        const fourthPage = pages[3]

        //console.log(secondPage);

        // Get the width and height of the first page
        const { width, height } = firstPage.getSize()
        const width1 = secondPage.getSize().width
        const height1 = secondPage.getSize().height
        const height2 = thirdPage.getSize().height
        const width2 = thirdPage.getSize().width
        const height3 = fourthPage.getSize().height
        const width3 = fourthPage.getSize().width

        //__________

        const pngUrl = 'arrow.png'
        const png1Url = 'rectangle.png'
        const png2Url = 'textandsymbols.png'

        const pngImageBytes = await fetch(pngUrl).then((res) => res.arrayBuffer())
        const pngImage1Bytes = await fetch(png1Url).then((res) => res.arrayBuffer())
        const pngImage2Bytes = await fetch(png2Url).then((res) => res.arrayBuffer())
     
        const pngImage = await pdfDoc.embedPng(pngImageBytes)
        const pngImage1 = await pdfDoc.embedPng(pngImage1Bytes)
        const pngImage2 = await pdfDoc.embedPng(pngImage2Bytes)
        
        const pngDims = pngImage.scale(0.3)

        const page = pdfDoc.addPage()

        firstPage.drawImage(pngImage, {
            x: page.getWidth() / 2 - pngDims.width / 2 + 100,
            y: page.getHeight() / 2 - pngDims.height / 2 + 200,
            width: pngDims.width,
            height: pngDims.height,
        })

        secondPage.drawText('Write your text here ....!', {
        x: 5,
        y: height1 / 2 + 300,
        size: 50,
        font: helveticaFont,
        color: rgb(0.95, 0.1, 0.1),
        rotate: degrees(-45),
      })

        thirdPage.drawImage(pngImage1, {
            x: page.getWidth() / 2 - pngDims.width / 2 + 100,
            y: page.getHeight() / 2 - pngDims.height / 2 + 200,
            width: pngDims.width,
            height: pngDims.height,
        })

        fourthPage.drawImage(pngImage2, {
            x: page.getWidth() / 2 - pngDims.width / 2 + 100,
            y: page.getHeight() / 2 - pngDims.height / 2 + 200,
            width: pngDims.width,
            height: pngDims.height,
        })

        const pdfBytes = await pdfDoc.save()
        download(pdfBytes, "pdf-download.pdf", "application/pdf");
    }

    /*
      var width = window.innerWidth;
      var height = window.innerHeight;

      var stage = new Konva.Stage({
        container: 'container',
        width: width,
        height: height,
      });

      var layer = new Konva.Layer();
      stage.add(layer);
      
      var rectangle = new Konva.Rect({
        x: 400,
        y: 250,
        width: 100,
        height: 30,
        fill: 'Yellow',
        opacity: 0.5
      });

      var arrow = new Konva.Arrow({
        x: 550,
        y: 390,
        points: [0, 0, -100, -100],
        pointerLength : 20,
        pointerWidth: 20,
        fill: 'Red',
        stroke: 'Red',
        strokeWidth: 5
      });

      var txt = new Konva.Text({
        x: 450,
        y: 390,
        text: 'Test text',
        fontSize: 50,
        fontFamily: 'Calibri'
      });

      layer.add(rectangle);
      layer.add(arrow);
      layer.add(txt);

      layer.draw();

      // function from https://stackoverflow.com/a/15832662/512042
      function downloadURI(uri, name) {
        var link = document.createElement('a');
        link.download = name;
        link.href = uri;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        delete link;
      }

      document.getElementById('save').addEventListener(
        'click',
        function () {
          var dataURL = stage.toDataURL({ pixelRatio: 3 });
          downloadURI(dataURL, 'textandsymbols.png');
        },
        false
      );
      */
    </script>
</body>
</html>